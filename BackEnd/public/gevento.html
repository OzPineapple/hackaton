<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Generar evento</title>
</head>
<body style="background: url(imagenes/registro.png);background-size: cover;">
    <header class="abajo">
        <a href="admin.html" class="logo">TICKETMUNSTER</a>
        <nav>
            <ul>
                <li><a href="">Generar evento</a></li>
                <li><a href="">Leer QR</a></li>
            </ul>
        </nav>
    </header>
    <section class="gevento">
        <div class="ev">
            <h2>Generar evento</h2><br><br>
                <form action="" style="border: 2px solid;border-color: red;width: 85%;margin: auto;padding: 20px;" id="form" >
                    <label for="nevent" class="reg">Nombre del evento:</label>
                    <input type="text" name="eventName" id="nevent" class="regim">
                    <br><br>
                    <label for="cost" class="reg">Costo del evento:</label>
                    <input type="number" name="price" id="cost" class="regim">
                    <br><br>
                    <label for="numbo" class="reg">Numero de lugares:</label>
                    <input type="number" name="lug" id="numbo" class="regim">
                    <br><br>
                    <label for="lugar" class="reg">Lugar del evento:</label>
                    <select name="ubi" id="lugar">
                        <option value="1">Seleccione el lugar del evento</option>
                    </select>
                    <br><br>
                    <label for="tipoe" class="reg">Tipo de evento</label>
                    <select name="type" id="tipoe">
                        <option value="">Seleccione el tipo de evento</option>
                        <option value="1">Concierto</option>
                        <option value="2">Deporte</option>
                        <option value="3">Cultura y teatro</option>
                    </select>
                    <br><br>
                    <label for="organizador" class="reg">Organizador del evento:</label>
                    <input type="text" name="org" id="organizador" class="regim">
                    <br><br>
                    <label for="fecha" class="reg">Fecha del evento:</label>
                    <input type="datetime-local" id="fecha" name="date" value="2023-02-26T16:30:00.000Z">
                    <br><br>
                    <label for="deseve" class="reg">Descripción del evento:</label><br>
                    <textarea name="desc" id="deseve" cols="30" rows="10"></textarea>
                    <br><br>
                    <button class="enviar">Registrar evento</button>
                </form>
        </div>
    </section>
    <script>
        var nome = document.querySelector("#nevent");
        var lugar = document.querySelector("#lugar");
        var tipoe = document.querySelector("#tipoe");
        var organizador = document.querySelector("#organizador");
        var fecha = document.querySelector("#fecha");
        var deseve = document.querySelector("#deseve");
       var form = document.querySelector("#form");
        var numbo = document.querySelector("#numbo");
        var cost = document.querySelector("#cost");
        var enviar = document.querySelector(".enviar");

        enviar.addEventListener("click", function (e) {
            var form = document.querySelector("#form");
            e.preventDefault();
            if (nome.value.length!=0 && lugar.value.length!=0&& tipoe.value.length!=0&& organizador.value.length!=0&& fecha.value.length!=0&& deseve.value.length!=0&& cost.value.length!=0 && numbo.value.length!=0) {
                send(e,form);
            } else {
                alert("Datos faltantes");
            }
        })
        async function send(e,form){
            e.preventDefault();
             var d = new URLSearchParams(new FormData(form));
             d.append("dispo", numbo.value);
             console.log(d);
            let resolt = await fetch("/administrador/evento/new",{
                method: 'POST', body:  d,
            });
            switch (resolt.status) {
                case 201:
                    alert("Registro exitoso!");
                    window.open("admin.html","_self");
                    break;
                case 404:
                    alert("Usuario no existe");
                    break;
                case 500:
                    alert("Error en servidor");
                    break;
                case 401:
                    alert("Error dde contraseña");
                    break;
            }
        }

        async function venid(e) {
            var resolt = await fetch("/tienda/ubi");
            var sta = resolt.status;
            resolt = await resolt.json();
            switch (sta) {
                case 200:
                for (let i = 0; i < resolt.length; i++) {
                var op = document.createElement("option");
                op.value= resolt[i].id_text;
                op.text= resolt[i].ubicacion;
                lugar.appendChild(op);
                }
                    break;
                case 404:
                    alert("Usuario no existe");
                    break;
                case 500:
                    alert("Error en servidor");
                    break;
                case 401:
                    alert("Error dde contraseña");
                    break;
            }
        }
        window.onload = (event) => {
            venid(event);
        };
    </script>
</body>
</html>